# テスト概要

このドキュメントは、Prompsプロジェクトのテスト戦略、実行方法、テストケースの全体像を説明します。

**最終更新**: 2026-02-18
**総テスト数**: 282件（Rust 92件 + JavaScript 190件）

---

## 目次

- [テスト哲学](#テスト哲学)
- [テスト構成](#テスト構成)
- [クイックスタート](#クイックスタート)
- [テストの実行方法](#テストの実行方法)
- [テスト設計原則](#テスト設計原則)

---

## テスト哲学

Prompsプロジェクトは、**段階的テスト実装**の方針を採用しています。

### 基本原則

1. **即時テスト実装**
   - 機能実装後、すぐにテストを追加
   - バグの早期発見により、後続フェーズへの影響を最小化

2. **100%パス率の維持**
   - 常にすべてのテストが合格する状態を保つ
   - テストが失敗したまま次のフェーズに進まない

3. **段階的な拡張**
   - Phase 0 → Phase 1 → Phase 2 と、フェーズごとにテストを追加
   - 各フェーズで確実に動作を確認してから次へ

---

## テスト構成

### アーキテクチャ

```
┌──────────────────────────────────────────────┐
│  フロントエンド（JavaScript）                 │
│  - blockly-config.test.js                    │
│  - main.test.js                              │
│  - project-manager.test.js                   │
│  - validation-ui.test.js                     │
│  - i18n.test.js                              │
│  合計: 190件                                  │
└──────────────┬───────────────────────────────┘
               │
               │ Tauri IPC
               │
┌──────────────▼───────────────────────────────┐
│  バックエンド（Rust）                         │
│  - src/lib.rs: 13件                          │
│  - src/commands.rs: 25件                     │
│  - src/modules/validation.rs: 54件           │
│  合計: 92件                                   │
└──────────────────────────────────────────────┘
```

### ディレクトリ構造

```
Promps/
├── src/                              # Rustバックエンド
│   ├── lib.rs                        # コアロジックテスト (13件)
│   ├── commands.rs                   # Tauriコマンドテスト (25件)
│   └── modules/
│       └── validation.rs             # 検証エンジンテスト (54件)
│
├── res/tests/                        # JavaScriptフロントエンド (Jest + JSDOM)
│   ├── blockly-config.test.js        # ブロック定義・ワークスペーステスト
│   ├── main.test.js                  # UIロジック・プレビューテスト
│   ├── project-manager.test.js       # プロジェクト永続化テスト
│   ├── validation-ui.test.js         # 検証UI表示テスト
│   └── i18n.test.js                  # i18n切替テスト
│
└── docs/testing/                     # テストドキュメント
    ├── ja/                           # 日本語（このディレクトリ）
    └── en/                           # 英語
```

---

## クイックスタート

### 全テストを実行

```bash
# バックエンド + フロントエンド
cargo test && cd res/tests && npm test
```

### フロントエンドのみ

```bash
cd res/tests
npm test
```

### バックエンドのみ

```bash
cargo test
```

---

## テストの実行方法

### 1. フロントエンドテスト（JavaScript）

#### セットアップ（初回のみ）

```bash
cd res/tests
npm install
```

#### 全テスト実行

```bash
npm test
```

#### 特定ファイルのみ実行

```bash
npm test blockly-config.test.js
npm test main.test.js
npm test validation-ui.test.js
```

#### ウォッチモード（開発中）

```bash
npm test -- --watch
```

---

### 2. バックエンドテスト（Rust）

#### 全テスト実行

```bash
cargo test
```

#### 特定モジュールのみ実行

```bash
cargo test --lib            # lib.rs のみ
cargo test --bin promps     # commands.rs のみ
cargo test validation       # validation.rs テスト
```

#### 詳細出力

```bash
cargo test -- --nocapture
```

---

## テスト設計原則

### Phase 0: 基礎テスト（CLI）

**対象**: コアパースロジック
**カバー範囲**:
- `_N:` プレフィックスの識別
- トークン分割ロジック
- DSL生成ロジック

### Phase 1: GUI統合テスト

**対象**: Blockly.js統合
**カバー範囲**:
- Blocklyブロック定義
- DSL生成ロジック（GUI版）
- UI変更イベント処理

### Phase 2: 助詞ブロックテスト

**対象**: 固定助詞ブロック
**カバー範囲**:
- 全9種類の助詞（が、を、に、で、と、へ、から、まで、より）
- 固定ラベル動作確認
- 実用的な文章生成パターン

### Phase 3: 動詞ブロックテスト

**対象**: 動詞ブロック（固定 + カスタム）
**カバー範囲**:
- 固定動詞ブロック（分析して、要約して、翻訳して 等）
- カスタム動詞入力
- 改行ブロック動作

### Phase 4: プロジェクト永続化テスト

**対象**: 保存/読込機能
**カバー範囲**:
- プロジェクトの保存/読込ラウンドトリップ
- 新規プロジェクト作成
- ファイルダイアログ統合

### Phase 5-6: 検証テスト

**対象**: 文法検証エンジン
**カバー範囲**:
- トークン分類（名詞、助詞、動詞、句読点 等）
- シーケンス検証ルール（6ルール）
- パターンテンプレートマッチング（7パターン）
- 日本語・英語ロケール対応

---

## テストカバレッジ

### Phase別テスト数推移

| Phase | フロントエンド | バックエンド | 合計 |
|-------|---------------|-------------|------|
| Phase 0 | 0 | 13 | 13 |
| Phase 1 | 31 | 26 | 57 |
| Phase 2 | 42 | 26 | 68 |
| Phase 3 | 61 | 26 | 87 |
| Phase 4 | — | — | — |
| Phase 5-6 | — | 54 | — |
| v1.1+ (i18n) | — | — | — |
| **現在 (v1.3.3)** | **190** | **92** | **282** |

### 成功率

- **現在**: 100%（282/282件合格）
- **目標**: 常に100%を維持

---

## 注意事項

### Node.jsバージョン

フロントエンドテストはES Modulesを使用しているため、Node.js 14.8.0以上が必要です。

```bash
node --version  # v14.8.0以上を確認
```

### 環境変数

特別な環境変数は不要です。

### テスト実行順序

テストは独立しているため、任意の順序で実行可能です。

---

## トラブルシューティング

### フロントエンドテストが失敗する

```bash
# node_modulesを再インストール
cd res/tests
rm -rf node_modules package-lock.json
npm install
npm test
```

### バックエンドテストが失敗する

```bash
# ビルドキャッシュをクリア
cargo clean
cargo test
```

---

## 関連ドキュメント

- [フロントエンドテストインデックス](./FRONTEND_TEST_INDEX.md) - 全テストケースの詳細
- [ユーザーガイド（日本語）](../../user/ja/USER_GUIDE.md) - 基本操作
- [User Guide (English)](../../user/en/USER_GUIDE.md) - 基本操作（英語版）
