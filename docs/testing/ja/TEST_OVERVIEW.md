# テスト概要

このドキュメントは、Prompsプロジェクトのテスト戦略、実行方法、テストケースの全体像を説明します。

**最終更新**: 2025-12-06
**総テスト数**: 68件（Rust 26件 + JavaScript 42件）

---

## 目次

- [テスト哲学](#テスト哲学)
- [テスト構成](#テスト構成)
- [クイックスタート](#クイックスタート)
- [テストの実行方法](#テストの実行方法)
- [テスト設計原則](#テスト設計原則)

---

## テスト哲学

Prompsプロジェクトは、**段階的テスト実装**の方針を採用しています。

### 基本原則

1. **即時テスト実装**
   - 機能実装後、すぐにテストを追加
   - バグの早期発見により、後続フェーズへの影響を最小化

2. **100%パス率の維持**
   - 常にすべてのテストが合格する状態を保つ
   - テストが失敗したまま次のフェーズに進まない

3. **段階的な拡張**
   - Phase 0 → Phase 1 → Phase 2 と、フェーズごとにテストを追加
   - 各フェーズで確実に動作を確認してから次へ

---

## テスト構成

### アーキテクチャ

```
┌─────────────────────────────────────────────┐
│  フロントエンド（JavaScript）              │
│  - blockly-config.test.js: 30件            │
│  - main.test.js: 12件                      │
│  合計: 42件                                 │
└──────────────┬──────────────────────────────┘
               │
               │ Tauri IPC
               │
┌──────────────▼──────────────────────────────┐
│  バックエンド（Rust）                      │
│  - src/lib.rs: 13件                        │
│  - src/commands.rs: 13件                   │
│  合計: 26件                                 │
└─────────────────────────────────────────────┘
```

### ディレクトリ構造

```
Promps/
├── src/                          # Rustバックエンド
│   ├── lib.rs                    # コアロジックテスト (13件)
│   └── commands.rs               # Tauriコマンドテスト (13件)
│
├── res/tests/                    # JavaScriptフロントエンド
│   ├── blockly-config.test.js    # Blocklyブロックテスト (30件)
│   └── main.test.js              # UIロジックテスト (12件)
│
└── docs/testing/                 # テストドキュメント
    ├── ja/
    │   ├── TEST_OVERVIEW.md      # このファイル
    │   └── FRONTEND_TEST_INDEX.md # フロントエンドテストインデックス
    └── en/
        └── (英語版ドキュメント)
```

---

## クイックスタート

### 全テストを実行

```bash
# ルートディレクトリで
./run_all_tests.sh
```

### フロントエンドのみ

```bash
cd res/tests
npm test
```

### バックエンドのみ

```bash
cargo test
```

---

## テストの実行方法

### 1. フロントエンドテスト（JavaScript）

#### セットアップ（初回のみ）

```bash
cd res/tests
npm install
```

#### 全テスト実行

```bash
npm test
```

#### 特定ファイルのみ実行

```bash
npm test blockly-config.test.js
npm test main.test.js
```

#### ウォッチモード（開発中）

```bash
npm test -- --watch
```

---

### 2. バックエンドテスト（Rust）

#### 全テスト実行

```bash
cargo test
```

#### 特定モジュールのみ実行

```bash
cargo test --lib          # lib.rs のみ
cargo test --bin promps   # commands.rs のみ
```

#### 詳細出力

```bash
cargo test -- --nocapture
```

---

## テスト設計原則

### Phase 0: 基礎テスト（CLI）

**対象**: コアパースロジック
**テスト数**: 21件（Rust 13件 + Commands 8件）

**カバー範囲**:
- `_N:` プレフィックスの識別
- トークン分割ロジック
- DSL生成ロジック

---

### Phase 1: GUI統合テスト

**対象**: Blockly.js統合
**テスト数**: 31件（既存21件 + 新規10件）

**カバー範囲**:
- Blockly ブロック定義
- DSL生成ロジック（GUI版）
- UI変更イベント処理

---

### Phase 2: 助詞ブロックテスト

**対象**: 固定助詞ブロック
**テスト数**: 42件（既存31件 + 新規11件）

**カバー範囲**:
- 9種類の助詞ブロック（が、を、に、で、と、へ、から、まで、より）
- 固定ラベル動作確認
- 実用的な文章生成パターン

**新規追加テスト**:
- 個別助詞テスト: 9件
- 一括テスト: 1件
- 実用パターン: 3件
  - `User が Order を 作成`
  - `Database から Data まで 移行`
  - `User と Admin が 作成`

---

## テストカバレッジ

### Phase別テスト数推移

| Phase | Frontend | Backend | Total | 備考 |
|-------|----------|---------|-------|------|
| Phase 0 | 0 | 21 | 21 | CLI版 |
| Phase 1 | 31 | 26 | 57 | GUI統合 |
| Phase 2 | 42 | 26 | 68 | 助詞ブロック |

### 成功率

- **現在**: 100% (68/68件合格)
- **目標**: 常に100%を維持

---

## テスト実行時の注意点

### 1. Node.jsバージョン

フロントエンドテストは ES Modules を使用しているため、Node.js 14.8.0以上が必要です。

```bash
node --version  # v14.8.0以上を確認
```

### 2. 環境変数

特別な環境変数は不要です。

### 3. テスト実行順序

テストは独立しているため、任意の順序で実行可能です。

---

## 次のフェーズでのテスト計画

### Phase 3: 動詞ブロック（予定）

- 基本動詞ブロックのテスト
- 動詞の活用形テスト

### Phase 4: 接続詞ブロック（予定）

- 接続詞ブロックのテスト
- 複文生成テスト

### Phase N: 文法チェック（予定）

- パターンマッチングテスト
- 助詞の正しい使用チェック

---

## トラブルシューティング

### フロントエンドテストが失敗する

```bash
# node_modulesを再インストール
cd res/tests
rm -rf node_modules package-lock.json
npm install
npm test
```

### バックエンドテストが失敗する

```bash
# ビルドキャッシュをクリア
cargo clean
cargo test
```

---

## 関連ドキュメント

- [フロントエンドテストインデックス](./FRONTEND_TEST_INDEX.md) - 全テストケースの詳細
- [ユーザーガイド](../../ja/USER_GUIDE.md) - 基本操作

---

**このドキュメントは Phase 2 時点のものです。今後のフェーズで内容が更新されます。**
